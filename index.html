<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HbA1c & Avg Glucose Converter</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #6f86d6 0%, #48c6ef 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .converter-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      padding: 2rem;
      max-width: 480px;
      width: 100%;
    }
    .converter-card h1 {
      font-weight: 600;
      margin-bottom: 1.5rem;
      text-align: center;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="converter-card">
    <h1>Glucose & HbA1c Converter</h1>
    <form>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="ngsp" placeholder="7.0" step="any">
        <label for="ngsp">HbA1c (NGSP, %)</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="ifcc" placeholder="53" step="any">
        <label for="ifcc">HbA1c (IFCC, mmol/mol)</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="mgdl" placeholder="154" step="any">
        <label for="mgdl">Avg Glucose (mg/dL)</label>
      </div>
      <div class="form-floating mb-3">
        <input type="number" class="form-control" id="mmoll" placeholder="8.6" step="any">
        <label for="mmoll">Avg Glucose (mmol/L)</label>
      </div>
    </form>
  </div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Conversion constants
    const A1C_IFCC_SLOPE    = 0.09148;
    const A1C_IFCC_INTERCPT = 2.152;
    const A1C_EAG_SLOPE     = 28.7;
    const A1C_EAG_INTERCPT  = -46.7;
    const MGDL_TO_MMOLL     = 1/18;
    const MMOLL_TO_MGDL     = 18;

    // Inputs
    const ngspInput  = document.getElementById('ngsp');
    const ifccInput  = document.getElementById('ifcc');
    const mgdlInput  = document.getElementById('mgdl');
    const mmollInput = document.getElementById('mmoll');

    function updateFrom(source) {
      let ngsp, ifcc, mgdl, mmoll;

      if (source === 'ngsp') {
        ngsp = parseFloat(ngspInput.value); if (isNaN(ngsp)) return;
        ifcc = (ngsp - A1C_IFCC_INTERCPT) / A1C_IFCC_SLOPE;
        mgdl = A1C_EAG_SLOPE * ngsp + A1C_EAG_INTERCPT;
        mmoll = mgdl * MGDL_TO_MMOLL;
      }
      else if (source === 'ifcc') {
        ifcc = parseFloat(ifccInput.value); if (isNaN(ifcc)) return;
        ngsp = A1C_IFCC_SLOPE * ifcc + A1C_IFCC_INTERCPT;
        mgdl = A1C_EAG_SLOPE * ngsp + A1C_EAG_INTERCPT;
        mmoll = mgdl * MGDL_TO_MMOLL;
      }
      else if (source === 'mgdl') {
        mgdl = parseFloat(mgdlInput.value); if (isNaN(mgdl)) return;
        ngsp = (mgdl - A1C_EAG_INTERCPT) / A1C_EAG_SLOPE;
        ifcc = (ngsp - A1C_IFCC_INTERCPT) / A1C_IFCC_SLOPE;
        mmoll = mgdl * MGDL_TO_MMOLL;
      }
      else if (source === 'mmoll') {
        mmoll = parseFloat(mmollInput.value); if (isNaN(mmoll)) return;
        mgdl = mmoll * MMOLL_TO_MGDL;
        ngsp = (mgdl - A1C_EAG_INTERCPT) / A1C_EAG_SLOPE;
        ifcc = (ngsp - A1C_IFCC_INTERCPT) / A1C_IFCC_SLOPE;
      }

      if (source !== 'ngsp')  ngspInput.value  = ngsp.toFixed(2);
      if (source !== 'ifcc')  ifccInput.value  = ifcc.toFixed(1);
      if (source !== 'mgdl')  mgdlInput.value  = mgdl.toFixed(0);
      if (source !== 'mmoll') mmollInput.value = mmoll.toFixed(1);
    }

    // Attach listeners
    ngspInput .addEventListener('input', () => updateFrom('ngsp'));
    ifccInput .addEventListener('input', () => updateFrom('ifcc'));
    mgdlInput .addEventListener('input', () => updateFrom('mgdl'));
    mmollInput.addEventListener('input', () => updateFrom('mmoll'));
  </script>
</body>
</html>
